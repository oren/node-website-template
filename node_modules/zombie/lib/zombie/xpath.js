// Generated by CoffeeScript 1.3.1
var engine, fs, html, vm, xpath;

vm = require("vm");

fs = require("fs");

html = require("jsdom").dom.level3.html;

engine = null;

xpath = function() {
  if (!engine) {
    engine = vm.Script.createContext();
    engine.navigator = {
      appVersion: "Zombie.js"
    };
    new vm.Script(fs.readFileSync(__dirname + "/../../xpath/util.js")).runInContext(engine);
    new vm.Script(fs.readFileSync(__dirname + "/../../xpath/xmltoken.js")).runInContext(engine);
    new vm.Script(fs.readFileSync(__dirname + "/../../xpath/xpath.js")).runInContext(engine);
  }
  return engine;
};

html.HTMLDocument.prototype.evaluate = function(expr, node, nsResolver, type, result) {
  var context;
  engine = xpath();
  context = new engine.ExprContext(node || this);
  context.setCaseInsensitive(true);
  result = engine.xpathParse(expr).evaluate(context);
  if (result.type === 'node-set') {
    result.value = result.value.sort(function(a, b) {
      var value;
      value = a.compareDocumentPosition(b);
      if (value === 2 || value === 8 || value === 10) {
        return 1;
      } else {
        return -1;
      }
    });
  }
  return result;
};
